{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block title %}نهایی کردن سفارش (تسویه حساب){% endblock %}

{% block content %}
<div class="py-8 px-4 sm:px-6 lg:px-8 bg-gray-50 min-h-screen" dir="rtl">
    <div class="max-w-7xl mx-auto">

        <!-- Header -->
        <header class="mb-8 text-center border-b border-gray-200 pb-4">
            <h1 class="text-3xl font-extrabold text-gray-900 mb-2">تسویه حساب و نهایی کردن سفارش</h1>
            <p class="text-lg text-gray-500">لطفاً اطلاعات ارسال و پرداخت را تکمیل کنید.</p>
        </header>

        <!-- Form -->
        <form method="post" action="{% url 'checkout' %}" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            {% csrf_token %}

            <!-- Order Summary -->
            <aside class="lg:col-span-1 order-1 lg:order-2">
                <div class="bg-white p-6 rounded-xl shadow-xl border border-gray-100 sticky lg:top-8">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 pb-3 border-b">خلاصه‌ی سفارش</h2>

                    <!-- Items -->
                    <div class="space-y-4 mb-4 max-h-72 overflow-y-auto">
                        {% for item in cart.items %}
                        <div class="flex justify-between items-center text-sm border-b pb-2">
                            <span class="text-gray-600">{{ item.product.name }}{% if item.variant %} ({{ item.variant.name }}){% endif %}</span>
                            <span class="font-medium text-gray-800">{{ item.total_price|intcomma }} تومان</span>
                        </div>
                        {% endfor %}
                    </div>

                    <!-- Totals -->
                    <div class="space-y-3 pt-2 border-t border-gray-200">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">جمع کل کالاها:</span>
                            <span class="font-semibold">{{ cart.sub_total|intcomma }} تومان</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">هزینه ارسال:</span>
                            <span class="font-semibold text-red-500">{{ cart.shipping_fee|intcomma }} تومان</span>
                        </div>
                        <div class="flex justify-between text-lg font-extrabold pt-2 border-t border-dashed border-gray-300">
                            <span class="text-gray-900">مبلغ قابل پرداخت:</span>
                            <span class="text-lime-700">{{ cart.final_total|intcomma }} تومان</span>
                        </div>
                    </div>

                    <!-- Checkout Button -->
                    <button type="submit" class="w-full px-6 py-3 bg-lime-600 text-white font-bold rounded-xl hover:bg-lime-700 transition duration-300 shadow-lg shadow-lime-300/50 mt-4">
                        پرداخت و نهایی کردن سفارش
                    </button>
                </div>
            </aside>

            <!-- Customer Info -->
            <div class="lg:col-span-2 order-2 lg:order-1 space-y-8">

                <!-- Buyer Info -->
                <section class="bg-white p-6 md:p-8 rounded-xl shadow-xl border border-gray-100">
                    <h2 class="text-xl font-bold text-gray-800 mb-6 pb-3 border-b">۱. اطلاعات خریدار و ارسال</h2>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                        <div class="flex flex-col">
                            <label for="id_full_name" class="text-sm font-semibold text-gray-700 mb-2">نام و نام خانوادگی</label>
                            <input type="text" id="id_full_name" name="full_name" required
                                   placeholder="مانند: علی احمدی"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm text-gray-900 focus:outline-none focus:ring-2 focus:ring-lime-400 focus:border-lime-500 transition duration-200">
                        </div>

                        <div class="flex flex-col">
                            <label for="id_email" class="text-sm font-semibold text-gray-700 mb-2">ایمیل</label>
                            <input type="email" id="id_email" name="email" required
                                   placeholder="example@gmail.com"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm text-gray-900 focus:outline-none focus:ring-2 focus:ring-lime-400 focus:border-lime-500 transition duration-200">
                        </div>

                        <div class="flex flex-col">
                            <label for="id_phone" class="text-sm font-semibold text-gray-700 mb-2">شماره تماس</label>
                            <input type="tel" id="id_phone" name="phone" required
                                   placeholder="۰۹۱۲۱۰۰۰۰۰۰"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm text-gray-900 focus:outline-none focus:ring-2 focus:ring-lime-400 focus:border-lime-500 transition duration-200">
                        </div>

                        <div class="flex flex-col md:col-span-2">
                            <label for="id_address" class="text-sm font-semibold text-gray-700 mb-2">آدرس کامل پستی</label>
                            <textarea id="id_address" name="address" required rows="3"
                                      placeholder="استان، شهر، خیابان، پلاک، واحد"
                                      class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm text-gray-900 focus:outline-none focus:ring-2 focus:ring-lime-400 focus:border-lime-500 transition duration-200 resize-none"></textarea>
                        </div>

                    </div>
                </section>

                <!-- Payment Info -->
                <section class="bg-white p-6 md:p-8 rounded-xl shadow-xl border border-gray-100">
                    <h2 class="text-xl font-bold text-gray-800 mb-6 pb-3 border-b">۲. روش پرداخت</h2>

                    <div class="space-y-4">
                        <label class="flex items-center p-4 border border-lime-300 rounded-xl bg-lime-50 cursor-pointer shadow-md">
                            <input type="radio" name="payment_method" value="online" checked class="w-5 h-5 text-lime-600 focus:ring-lime-500 border-gray-300">
                            <span class="mr-3 text-lg font-semibold text-lime-700">پرداخت آنلاین از طریق درگاه بانکی</span>
                        </label>
                    </div>

                    <div class="mt-6 text-sm text-gray-500 p-3 bg-gray-50 rounded-lg">
                        <p>با کلیک بر روی دکمه "پرداخت"، به صفحه‌ی درگاه امن بانکی هدایت خواهید شد.</p>
                    </div>
                </section>

                <!-- Mobile Checkout Button -->
                <button type="submit" class="lg:hidden w-full px-6 py-3 bg-lime-600 text-white font-bold rounded-xl hover:bg-lime-700 transition duration-300 shadow-lg shadow-lime-300/50">
                    پرداخت و نهایی کردن سفارش
                </button>
            </div>

        </form>
    </div>
</div>

<style>
/* فقط برای حالت hover و جزئیات اضافی */
.radio-option:checked + span {
    font-weight: 700;
}
</style>

{% endblock content %}

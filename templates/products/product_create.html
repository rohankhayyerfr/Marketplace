{% extends 'base.html' %}
{% block content %}


<form action="{% url 'store:product_create' %}" method="POST" enctype="multipart/form-data"
      class="max-w-4xl mx-auto bg-white shadow-lg rounded-2xl p-6 space-y-8">
    {% csrf_token %}

    <!-- Product Base Info -->
    <div>
        <h2 class="text-xl font-bold mb-3">اطلاعات اصلی محصول</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

            <div>
                <label class="block mb-1 font-medium">نام محصول</label>
                <input name="name" type="text" required
                       class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-blue-400" />
            </div>

            <div>
                <label class="block mb-1 font-medium">Slug</label>
                <input name="slug" type="text" required
                       class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-blue-400" />
            </div>

            <div>
                <label class="block mb-1 font-medium">دسته‌بندی</label>
                <select name="category" required
                        class="w-full border rounded-lg p-2">
                    {% for cat in main_categories %}
                        <option value="{{ cat.id }}">{{ cat.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <label class="block mb-1 font-medium">قیمت</label>
                <input name="price" type="number" step="0.01" required
                       class="w-full border rounded-lg p-2" />
            </div>

            <div>
                <label class="block mb-1 font-medium">موجودی</label>
                <input name="inventory" type="number" required
                       class="w-full border rounded-lg p-2" />
            </div>

            <div>
                <label class="block mb-1 font-medium">تصویر اصلی</label>
                <input name="main_image" type="file" accept="image/*" required
                       class="w-full border rounded-lg p-2" />
            </div>

        </div>

        <label class="block font-medium mt-4">توضیحات</label>
        <textarea name="description" rows="4"
                  class="w-full border rounded-lg p-3"></textarea>
    </div>

    <!-- Product Gallery -->
<h2 class="text-xl font-bold mb-3">گالری تصاویر</h2>

{{ gallery_formset.management_form }}

<div id="gallery-wrapper" class="space-y-3">

    {% for form in gallery_formset %}
    <div class="flex items-center gap-3" data-form-index="{{ forloop.counter0 }}">
        {{ form.id }}
        <input
            type="file"
            name="gallery-{{ forloop.counter0 }}-image"
            class="border rounded-lg p-2"
        />
    </div>
    {% endfor %}

</div>

<button type="button" onclick="addGallery()"
        class="mt-3 px-4 py-2 bg-blue-600 text-white rounded-lg">
    + افزودن تصویر
</button>

<script>
let galleryTotal = {{ gallery_formset.total_form_count }};

function addGallery() {
    let wrapper = document.getElementById('gallery-wrapper');

    let newInput =
    `<div class="flex items-center gap-3" data-form-index="${galleryTotal}">
        <input type="file"
            name="gallery-${galleryTotal}-image"
            class="border rounded-lg p-2"/>
    </div>`;

    wrapper.insertAdjacentHTML('beforeend', newInput);

    galleryTotal++;
    document.getElementById("id_gallery-TOTAL_FORMS").value = galleryTotal;
}
</script>

    <!-- Features -->
    <h2 class="text-xl font-bold mb-3">ویژگی‌های محصول</h2>

{{ feature_formset.management_form }}

<div id="feature-wrapper" class="space-y-4">
    {% for form in feature_formset %}
    <div class="grid grid-cols-1 md:grid-cols-3 gap-3" data-form-index="{{ forloop.counter0 }}">
        {{ form.id }}
        <input type="file" name="features-{{ forloop.counter0 }}-icon" class="border rounded-lg p-2" />
        <input type="text" name="features-{{ forloop.counter0 }}-title" placeholder="عنوان" class="border rounded-lg p-2"/>
        <input type="text" name="features-{{ forloop.counter0 }}-description" placeholder="توضیح" class="border rounded-lg p-2"/>
    </div>
    {% endfor %}
</div>

<button type="button" onclick="addFeature()"
        class="mt-3 px-4 py-2 bg-blue-600 text-white rounded-lg">
    + افزودن ویژگی
</button>

<script>
let featureTotal = {{ feature_formset.total_form_count }};
function addFeature() {
    let wrap = document.getElementById('feature-wrapper');

    wrap.insertAdjacentHTML('beforeend',
        `<div class="grid grid-cols-1 md:grid-cols-3 gap-3" data-form-index="${featureTotal}">
            <input type="file" name="features-${featureTotal}-icon" class="border rounded-lg p-2"/>
            <input type="text" name="features-${featureTotal}-title" class="border rounded-lg p-2"/>
            <input type="text" name="features-${featureTotal}-description" class="border rounded-lg p-2"/>
        </div>`
    );

    featureTotal++;
    document.getElementById("id_features-TOTAL_FORMS").value = featureTotal;
}
</script>


    <!-- Specifications -->
<hr>
<h2 class="text-xl font-bold mb-3">مشخصات</h2>
    {{ specification_formset.management_form }}

<div id="spec-wrapper" class="space-y-3">

{% for form in specification_formset %}
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    {{ form.id }}
    <input type="text" name="specifications-{{ forloop.counter0 }}-title" placeholder="عنوان" class="border rounded-lg p-2"/>
    <input type="text" name="specifications-{{ forloop.counter0 }}-value" placeholder="مقدار" class="border rounded-lg p-2"/>
</div>
{% endfor %}

</div>

<button onclick="addSpec()" type="button"
        class="mt-3 px-4 py-2 bg-blue-600 text-white rounded-lg">
    + افزودن مشخصه
</button>

<script>
let specTotal = {{ specification_formset.total_form_count }};
function addSpec() {
    let wrap = document.getElementById('spec-wrapper');
    wrap.insertAdjacentHTML('beforeend', `
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <input type="text" name="specifications-${specTotal}-title" class="border rounded-lg p-2"/>
            <input type="text" name="specifications-${specTotal}-value" class="border rounded-lg p-2"/>
        </div>
    `);
    specTotal++;
    document.getElementById("id_specifications-TOTAL_FORMS").value = specTotal;
}
</script>


    <!-- Variants -->
<h2 class="text-xl font-bold mb-3">اضافه کردن گزینه برای خرید</h2>
    {{ variant_formset.management_form }}

<div id="variant-wrapper" class="space-y-4">

{% for form in variant_formset %}
<div data-form-index="{{ forloop.counter0 }}">
    {{ form.id }}

    <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
        <input type="text" name="variants-{{ forloop.counter0 }}-title" placeholder="موضوع" class="border rounded-lg p-2"/>
        <input type="number" name="variants-{{ forloop.counter0 }}-price" placeholder="قیمت" class="border rounded-lg p-2"/>
        <input type="number" name="variants-{{ forloop.counter0 }}-stock" placeholder="موجودی در انبار" class="border rounded-lg p-2"/>
        <label class="flex items-center gap-2">
            <input type="checkbox" name="variants-{{ forloop.counter0 }}-is_bestseller"/>
            پر فروش
        </label>
    </div>

    <textarea name="variants-{{ forloop.counter0 }}-description"
       placeholder="توضیحات گزینه" class="w-full border rounded-lg p-2 my-5"></textarea>
</div>
{% endfor %}

</div>

<button onclick="addVariant()" type="button"
        class="mt-3 px-4 py-2 bg-blue-600 text-white rounded-lg">
    + افزودن واریانت
</button>

<script>
let variantTotal = {{ variant_formset.total_form_count }};
function addVariant() {
    let wrap = document.getElementById("variant-wrapper");

    wrap.insertAdjacentHTML("beforeend", `
        <div class="space-y-2" data-form-index="${variantTotal}">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                <input type="text" name="variants-${variantTotal}-title" class="border rounded-lg p-2"/>
                <input type="number" name="variants-${variantTotal}-price" class="border rounded-lg p-2"/>
                <input type="number" name="variants-${variantTotal}-stock"  class="border rounded-lg p-2"/>
                <label class="flex items-center gap-2">
                    <input type="checkbox" name="variants-${variantTotal}-is_bestseller"/>
                    پر فروش
                </label>
            </div>
            <textarea name="variants-${variantTotal}-description"
                class="w-full border rounded-lg p-2"></textarea>
        </div>
    `);

    variantTotal++;
    document.getElementById("id_variants-TOTAL_FORMS").value = variantTotal;
}
</script>


    <button type="submit"
            class="w-full py-3 bg-green-600 text-white font-bold rounded-xl text-lg">
        ثبت محصول
    </button>
</form>

<script>
function addGallery() {
    let wrapper = document.getElementById('gallery-wrapper');
    wrapper.insertAdjacentHTML('beforeend',
        `<div class="flex items-center gap-3"><input type="file" name="gallery_images" class="border rounded-lg p-2"/></div>`
    );
}

function addFeature() {
    let wrap = document.getElementById('feature-wrapper');
    wrap.insertAdjacentHTML('beforeend',
        `<div class="grid grid-cols-1 md:grid-cols-3 gap-3">
            <input type="file" name="feature_icon" class="border rounded-lg p-2"/>
            <input type="text" name="feature_title" placeholder="عنوان" class="border rounded-lg p-2"/>
            <input type="text" name="feature_description" placeholder="توضیح" class="border rounded-lg p-2"/>
        </div>`
    );
}

function addSpec() {
    let wrap = document.getElementById('spec-wrapper');
    wrap.insertAdjacentHTML('beforeend',
        `<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <input type="text" name="spec_title" placeholder="عنوان" class="border rounded-lg p-2"/>
            <input type="text" name="spec_value" placeholder="مقدار" class="border rounded-lg p-2"/>
        </div>`
    );
}

function addVariant() {
    let wrap = document.getElementById('variant-wrapper');
    wrap.insertAdjacentHTML('beforeend',
        `<div class="space-y-2">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                <input type="text" name="variant_title" placeholder="عنوان" class="border rounded-lg p-2"/>
                <input type="number" name="variant_price" placeholder="قیمت" class="border rounded-lg p-2"/>
                <input type="number" name="variant_stock" placeholder="موجودی" class="border rounded-lg p-2"/>
                <label class="flex items-center gap-2">
                    <input type="checkbox" name="variant_bestseller"/>
                    پر فروش
                </label>
            </div>
            <textarea name="variant_description" placeholder="توضیحات واریانت"
                      class="w-full border rounded-lg p-2"></textarea>
        </div>`
    );
}
</script>
{% endblock %}